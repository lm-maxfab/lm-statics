(()=>{var _=Object.create;var m=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty;var U=e=>m(e,"__esModule",{value:!0});var V=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var F=(e,t,i,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of j(t))!H.call(e,n)&&(i||n!=="default")&&m(e,n,{get:()=>t[n],enumerable:!(o=L(t,n))||o.enumerable});return e},k=(e,t)=>F(U(m(e!=null?_(N(e)):{},"default",!t&&e&&e.__esModule?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var b=V(y=>{"use strict";y.parse=K;y.serialize=z;var M=decodeURIComponent,G=encodeURIComponent,R=/; */,g=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function K(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var i={},o=t||{},n=e.split(R),d=o.decode||M,r=0;r<n.length;r++){var c=n[r],u=c.indexOf("=");if(!(u<0)){var $=c.substr(0,u).trim(),l=c.substr(++u,c.length).trim();l[0]=='"'&&(l=l.slice(1,-1)),i[$]==null&&(i[$]=B(l,d))}}return i}function z(e,t,i){var o=i||{},n=o.encode||G;if(typeof n!="function")throw new TypeError("option encode is invalid");if(!g.test(e))throw new TypeError("argument name is invalid");var d=n(t);if(d&&!g.test(d))throw new TypeError("argument val is invalid");var r=e+"="+d;if(o.maxAge!=null){var c=o.maxAge-0;if(isNaN(c)||!isFinite(c))throw new TypeError("option maxAge is invalid");r+="; Max-Age="+Math.floor(c)}if(o.domain){if(!g.test(o.domain))throw new TypeError("option domain is invalid");r+="; Domain="+o.domain}if(o.path){if(!g.test(o.path))throw new TypeError("option path is invalid");r+="; Path="+o.path}if(o.expires){if(typeof o.expires.toUTCString!="function")throw new TypeError("option expires is invalid");r+="; Expires="+o.expires.toUTCString()}if(o.httpOnly&&(r+="; HttpOnly"),o.secure&&(r+="; Secure"),o.sameSite){var u=typeof o.sameSite=="string"?o.sameSite.toLowerCase():o.sameSite;switch(u){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return r}function B(e,t){try{return t(e)}catch{return e}}});var f=k(b());var E=k(b());function I(){return typeof document=="object"&&typeof document.cookie=="string"}function O(e,t){return typeof e=="string"?E.parse(e,t):typeof e=="object"&&e!==null?e:{}}function J(e,t){return typeof t=="undefined"&&(t=!e||e[0]!=="{"&&e[0]!=="["&&e[0]!=='"'),!t}function v(e,t){t===void 0&&(t={});var i=Q(e);if(J(i,t.doNotParse))try{return JSON.parse(i)}catch{}return e}function Q(e){return e&&e[0]==="j"&&e[1]===":"?e.substr(2):e}var h=function(){return h=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},h.apply(this,arguments)},W=function(){function e(t,i){var o=this;this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.cookies=O(t,i),new Promise(function(){o.HAS_DOCUMENT_COOKIE=I()}).catch(function(){})}return e.prototype._updateBrowserValues=function(t){!this.HAS_DOCUMENT_COOKIE||(this.cookies=f.parse(document.cookie,t))},e.prototype._emitChange=function(t){for(var i=0;i<this.changeListeners.length;++i)this.changeListeners[i](t)},e.prototype.get=function(t,i,o){return i===void 0&&(i={}),this._updateBrowserValues(o),v(this.cookies[t],i)},e.prototype.getAll=function(t,i){t===void 0&&(t={}),this._updateBrowserValues(i);var o={};for(var n in this.cookies)o[n]=v(this.cookies[n],t);return o},e.prototype.set=function(t,i,o){var n;typeof i=="object"&&(i=JSON.stringify(i)),this.cookies=h(h({},this.cookies),(n={},n[t]=i,n)),this.HAS_DOCUMENT_COOKIE&&(document.cookie=f.serialize(t,i,o)),this._emitChange({name:t,value:i,options:o})},e.prototype.remove=function(t,i){var o=i=h(h({},i),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=h({},this.cookies),delete this.cookies[t],this.HAS_DOCUMENT_COOKIE&&(document.cookie=f.serialize(t,"",o)),this._emitChange({name:t,value:void 0,options:i})},e.prototype.addChangeListener=function(t){this.changeListeners.push(t)},e.prototype.removeChangeListener=function(t){var i=this.changeListeners.indexOf(t);i>=0&&this.changeListeners.splice(i,1)},e}(),S=W;var T=S;var X=e=>{let t=window.location.href,o=new RegExp(`[\\?&]${e}=([^&#]*)`).exec(t);return o===null?null:o[1]},P=()=>X("capdebug")!==null,w=e=>e.replace(/(<([^>]+)>)/gi,""),a=e=>{typeof e!="object"&&(e=[e]),console&&typeof console.log=="function"&&P()&&console.log("%cCAPPING","display: inline-block; color: #61d2a3; background: #193a4a; padding: 1px 4px; border-radius: 3px;",...e)},p=e=>{typeof e!="object"&&(e=[e]),console&&typeof console.error=="function"&&P()&&console.error("%cCAPPING","display: inline-block; color: #ff0000; background: #193a4a; padding: 1px 4px; border-radius: 3px;",...e)},A=()=>`_${Math.random().toString(36).substr(2,9)}`,C=(e,t)=>(Object.keys(t).forEach(i=>{typeof e[i]=="undefined"?e[i]=t[i]:typeof t[i]!=typeof e[i]?a(`bad configuration type for ${i}, must be an instance of ${typeof e[i]}`):typeof t[i]=="object"?C(e[i],t[i]):e[i]=t[i]}),e);var D={url:"https://capping.sirius.press",timeout:3e3,togglePopinFunction:e=>`${e}`,copyPasteObserver:{enable:!1,characterLimit:140,appendToClipboard:"",prependToClipboard:""}};typeof CAPPING_CONFIG!="undefined"&&C(D,CAPPING_CONFIG);var s=D;var x={locked:!1,stayTunedRunning:!1,lastAction:"",state:"stop",hello(){this.state!=="hello"&&(this.state="hello",this.lastAction="hello",a("hello"),window.fetch(`${s.url}/hello?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}&tolerance=${this.tolerance}`).then(e=>e.json()).then(()=>{this.state==="hello"&&this.ping()}).catch(e=>{this.state="stop",p(`Error with hello - ${e}`)}))},bye(){a("bye"),window.fetch(`${s.url}/bye?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}&tolerance=${this.tolerance}`)},determined(){this.state==="determined"||this.state==="hello"||this.state==="ping"||(this.state==="staytuned"&&s.togglePopinFunction(""),this.state="determined",this.lastAction="determined",a("hello determined"),window.fetch(`${s.url}/hello?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}&tolerance=${this.tolerance}&determined=1`).then(e=>e.json()).then(()=>{this.state==="determined"&&this.ping()}).catch(e=>{this.state="stop",p(`Error with hello - ${e}`)}))},ping(){this.state!=="ping"&&(this.state="ping",this.lastAction="ping",setTimeout(this.doPing.bind(this),s.timeout))},doPing(){document[this.hidden]||this.state!=="ping"?a("stop to ping"):(a("ping"),window.fetch(`${s.url}/ping?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}&tolerance=${this.tolerance}`).then(e=>e.json()).then(e=>{if(this.state==="ping")if(e.pause===!0)a("pause"),e.block===!0?(a("block"),s.togglePopinFunction(e.message),this.staytuned()):(this.state="stop",this.lastAction="");else{if(document[this.hidden]){this.state="stop",a("stop to ping");return}this.state="stop",this.ping()}}).catch(e=>{this.state="stop",p(`Error with ping - ${e}`)}))},staytuned(){this.state!=="staytuned"&&(this.state="staytuned",this.lastAction="staytuned",setTimeout(this.doStaytuned.bind(this),s.timeout))},doStaytuned(){document[this.hidden]||this.state!=="staytuned"?a("stop to stay tuned"):(a("stay tuned"),window.fetch(`${s.url}/stayTuned?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}&tolerance=${this.tolerance}`).then(e=>e.json()).then(e=>{if(this.state==="staytuned")if(e.block===!0)document[this.hidden]?(this.state="stop",a("stop to stay tuned")):(this.state="stop",this.staytuned());else{if(document[this.hidden]){this.state="stop",a("stop to stay tuned");return}a("unblock"),s.togglePopinFunction(""),this.state==="staytuned"&&this.hello()}}).catch(e=>{this.state="stop",p(`Error with stay tuned - ${e}`)}))},start(){if(typeof document.hidden!="undefined"?(this.hidden="hidden",this.visibilityChange="visibilitychange"):typeof document.msHidden!="undefined"?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),typeof s.userId=="undefined"||typeof s.brand=="undefined")return;typeof s.tolerance=="undefined"&&(s.tolerance="");let e=new T;this.deviceId=e.get("lmd_cap"),this.deviceId||(this.deviceId=A(),e.set("lmd_cap",this.deviceId,{path:"/",maxAge:60*60*24*365,domain:window.location.hostname,secure:!0,sameSite:"Lax"})),this.userId=s.userId,this.brand=s.brand,this.tolerance=s.tolerance,this.hello(),this.copyPasteObserver();let t=()=>{if(document[this.hidden])a("visibility hidden"),this.state==="ping"&&(this.state="stop",this.bye()),this.state==="hello"&&(this.state="stop",setTimeout(this.bye.bind(this),s.timeout));else{if(this.lastAction==="staytuned"){this.staytuned();return}(this.lastAction==="ping"||this.lastAction==="hello")&&this.hello()}};typeof document.addEventListener=="undefined"||typeof document[this.hidden]=="undefined"?p("Capping requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API."):document.addEventListener(this.visibilityChange,t,!1)},stop(){this.state="stop"},copyPasteObserver(){s.copyPasteObserver.enable===!0&&["cut","copy"].forEach(e=>{document.addEventListener(e,t=>{if(typeof t.clipboardData!="undefined"){let i=t.clipboardData.getData("Text")||window.getSelection().toString();if(i.length>s.copyPasteObserver.characterLimit){let o=s.copyPasteObserver.prependToClipboard,n=s.copyPasteObserver.appendToClipboard;if(o!==""||n!==""){let d=w(o)+i+w(n),r=o+i+n;t.clipboardData.setData("Text",d),t.clipboardData.setData("text/plain",d),t.clipboardData.setData("text/html",r),t.preventDefault()}a("Copy event!"),window.fetch(`${s.url}/copy?user=${this.userId}&brand=${this.brand}&device=${this.deviceId}`)}}})})}};x.start();window.restartCapping=function(){x.determined()};window.stopCapping=function(){x.stop()};})();
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
